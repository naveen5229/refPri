<nb-card>
  <nb-card-header>
    <div class="row">
      <div class="col-4">
        <h5 class="heading-design">Graphical Reports</h5>
      </div>
      <div class="col-5">
        <span style="display: flex;">
          <auto-suggestion class="form-controls col-9 p-0 searchselect" [data]="processList" display="name"
            placeholder="Search Process" inputId="ProcessSearch" name="ProcessSearch" #searchedProcess>
          </auto-suggestion>
          <button class="btn btn-primary btn-sm"
            (click)="getSideBarData(searchedProcess.selectedSuggestion)">Search</button>
        </span>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body>
    <div class="row mt-2 centarize">
      <div class="col-1 hoverChart" *ngFor="let image of chartTypes;let i = index"
        (click)="active = image.id;getChartofType(image.type);selectedChart = image.type">
        <span>
          <img src="{{image.url}}" height="80px" width="80px" [ngClass]="active==image.id?'active':''">
        </span>
      </div>
    </div>
    <div class="row mr-0">
      <div class="col-2 sidenavleft p-0">
        <div *ngFor="let data of sideBarData">
          <h6>{{data.title}}</h6>
          <ul *ngIf="data.children && data.children.length >0" class="child-ul">
            <li class="top" *ngFor="let head of data.children;let i = index" style="font-weight:bold"
              (click)="onHideShow(head,i)">
              <!--(click)="head.children? head.hideMe = !head.hideMe: head.hideMe = head.hideMe"-->
              <p class="drophead">{{head.title}} <span class="dropcaret"><i class="fas fa-sort-down"
                    style="cursor: pointer"></i></span></p>
              <ul *ngIf="head.isHide" id="unassign" cdkDropList [cdkDropListData]="head.children"
                [cdkDropListConnectedTo]="['assignDataRow','assignDataColumn','filter']" class="child-ul innerdrop"
                (cdkDropListDropped)="drop($event)" [cdkDropListEnterPredicate]="noReturnPredicate">
                <li class="drag-list" *ngFor="let sub of head.children;let i = index" cdkDrag>
                  {{sub.r_coltitle}}
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-10">
        <div class="row mt-2">
          <div class="col-2 text-right"><span style="color: red;">*</span><label> X-Axis:</label> </div>
          <div id="assignDataRow" cdkDropList [cdkDropListData]="assign.x" cdkDropListConnectedTo="menuList"
            class="col-10 drag-container" (cdkDropListDropped)="drop($event)">
            <div class="example-box fieldStyle" *ngFor="let n of assign.x;let i =index" cdkDrag [cdkDragData]="n">
              {{n.r_coltitle}}
              <i class="far fa-times-circle cancelButtonCss" (click)="removeField(i,'x')"></i>
            </div>
          </div>
        </div>
        <div class="row mt-2">
          <div class="col-2 text-right"><span style="color: red;">*</span><label>Y-Axis:</label> </div>
          <div id="assignDataColumn" cdkDropList [cdkDropListData]="assign.y" cdkDropListConnectedTo="menuList"
            class="col-10 drag-container" (cdkDropListDropped)="drop($event)">
            <div class="example-box fieldStyle" *ngFor="let n of assign.y;let i =index" cdkDrag [cdkDragData]="n">
              {{n.r_coltitle}}
              <i class="far fa-times-circle cancelButtonCss" (click)="removeField(i,'y')"></i>
              <select class="selectInsideSelected" (change)="addMeasure(i,'y',$event.target.value)">
                <!-- <option disabled selected>measure</option> -->
                <option>Date</option>
                <option selected>Count</option>
                <option>Average</option>
                <option>Sum</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row mt-2">
          <div class="col-2 text-right"><label> Filters:</label> </div>
          <div id="filter" cdkDropList [cdkDropListData]="assign.filter" cdkDropListConnectedTo="menuList"
            class="col-10 drag-container" (cdkDropListDropped)="drop($event)">
            <div class="example-box fieldStyle" *ngFor="let n of assign.filter;let i =index" cdkDrag [cdkDragData]="n">
              {{n.r_coltitle}}
              <i class="far fa-times-circle cancelButtonCss" (click)="removeField(i,'filter')"></i>
            </div>
          </div>
        </div>

        <div class="row mt-2" style="text-align: right;">
          <div class="col-12">
            <button class="btn btn-primary margin_right" (click)="openSaveModal()">Save</button>
            <button class="btn btn-primary" (click)="getReportPreview()">Preview</button>
          </div>
        </div>
        
        <div class="row mt-2">
          <div class="col-2"></div>
          <div class="col-8">
            <div class="chartbox">
              <canvas id="Graph"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nb-card-body>
</nb-card>


<!-- start:filter modal  -->
<div class="modal" id="filterModal" #filterModal>
  <div class="modal-dialog modal-lg">
      <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
              <h5 class="modal-title">Apply Filters</h5>
              <button type="button" class="close" data-dismiss="modal" (click)="closeSearchTaskModal()">&times;</button>
          </div>
          <!-- Modal body -->
          <div class="modal-body">
              <div class="row mt-2">
                    <div class="col-4">
                          <label>{{filterObject['r_coltitle']}}</label>
                    </div>
                    <div class="col-8" >
                          <div class="row" *ngFor="let subIndex of filterObject['filterdata'];let i = index">
                            <div class="col-2">
                              <select [(ngModel)]="subIndex.r_operators" #btw>
                                <option *ngFor="let sign of Operators" value="{{sign.id}}">{{sign.name | uppercase}}</option>
                              </select>
                            </div>
                            <div class="col-6">
                                  <input type="text" [(ngModel)]="subIndex.r_threshold[0]['r_value']" *ngIf="filterObject['r_coltype'] != 'timestamp'">
                                  <input type="date" [(ngModel)]="subIndex.r_threshold[0]['r_value']" *ngIf="filterObject['r_coltype'] === 'timestamp'">
                            </div>
                            <i class="fas fa-trash-alt" (click)="deletFilter(i)"></i>
                          </div>
                    </div>
                    <!-- {{filterObject | json}} -->
              </div>
              
              <div class="row mt-2">
                <div class="col-4">
                  <button type="submit" class="btn btn-primary" (click)="addFilter()">Add Filter</button>
                </div>                  
              </div>

              <div class="row mt-2" style="text-align: center;">
                <div class="col-12">
                  <button type="button" class="btn btn-success" (click)="storeFilter()">Save</button>
                </div>
              </div>
          </div>
      </div>
  </div>
</div>
<!-- end:filter modal -->

<!-- start : save as -->
<div class="modal" id="saveAs" #saveAs>
  <div class="modal-dialog modal-md">
      <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
              <h5 class="modal-title">Save As</h5>
              <button type="button" class="close" data-dismiss="modal" (click)="closeSaveModal()">&times;</button>
          </div>
          <!-- Modal body -->
          <div class="modal-body">
              
              <div class="row mt-2" style="text-align: center;">
                <div class="col-12">
                  <label>Name:</label><input type="text" [(ngModel)]="reportFileName">
                </div>                  
              </div>

              <div class="row mt-2" style="text-align: center;">
                <div class="col-12">
                  <button type="button" class="btn btn-success" (click)="saveGraphicReport()">Save</button>
                </div>
              </div>
          </div>
      </div>
  </div>
</div>
<!-- end : save as -->