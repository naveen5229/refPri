<nb-card>
    <nb-card-header>
        <div class="row">
            <div class="col-2">
                <h5 class="heading-design">Tasks</h5>
            </div>
            <div class="col-6">
                <div class="row">
                    <div class="col-2">
                        <select (change)="SearchBy = $event.target.value" class="byselect">
                            <option>By Task</option>
                            <option>By User</option>
                        </select>
                    </div>
                    <div class="col-10">
                        <span *ngIf = "SearchBy === 'By Task'">
                            <input type="text" class="form-controls col-9 searchbtn" placeholder="Search Task" #searchTaskText>
                            <button class="btn btn-primary btn-sm" (click)="getSearchTask(searchTaskText.value, null)">Search</button>
                        </span>
                        <span *ngIf = "SearchBy === 'By User'" style="display: flex;">
                            <auto-suggestion class="form-controls col-9 p-0 searchselect"  [data]="adminList"
                             display="name" placeholder="Search Users" inputId="Users" name="Users" #searchByUserId></auto-suggestion>
                            <button class="btn btn-primary btn-sm" (click)="getSearchTask(null,searchByUserId.selectedSuggestion.id)">Search</button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-4 text-right">
                <button class="btn btn-primary btn-sm mr-2 procss" (click)="common.gotoPage('/pages/my-process')" title="Go To Process"><img src="../../assets/images/process.svg" alt="process"></button>
                <button class="btn btn-primary btn-sm mr-2" title="Add Schedule Task" (click)="openSchedukedTaskMasterModal()">
                    <i class="fa fa-plus" style="font-size:12px;"></i> <b> ST</b>
                </button>
                <button class="btn btn-primary btn-sm mr-2" title="Add Project" (click)="showProjectPopup()">
                    <i class="fa fa-plus" style="font-size:12px;"></i> <b> P</b>
                </button>
                <button class="btn btn-primary btn-sm" title="Add Normal Task" (click)="showTaskPopup()"><i
                    class="fa fa-plus"></i></button>
                <!-- <button class="btn btn-primary btn-sm" title="Add Normal Task" (click)="applyLeave()">Req Leave</button> -->

                <!-- <span (click)="assignModal()">assign</span> -->
            </div>
        </div>
    </nb-card-header>
    <nb-card-body>
        <!-- Tabs      -->
        <div class="tabs_style_main">
            <ul class="tabs_style text-left">
                <li [ngClass]="activeTab=='TasksForMe'?'active':''" (click)="activeTab='TasksForMe'; getTaskByType(101)">
                    Tasks For Me
                </li>
                <li [ngClass]="activeTab=='TasksByMe'?'active':''" (click)="activeTab='TasksByMe'; getTaskByType(-101)">
                    Tasks By Me
                </li>
                <li [ngClass]="activeTab=='ccTask'?'active':''" (click)="activeTab='ccTask'; getTaskByType(-5)">
                    CC Task
                </li>
                <li [ngClass]="activeTab=='projectTask'?'active':''" (click)="activeTab='projectTask'; getTaskByType(-6)">
                    Project Task
                </li>
                <li [ngClass]="activeTab=='allCompletedTask'?'active':''" (click)="activeTab='allCompletedTask';resetSearchTask(); getTaskByType(-102)">
                    Completed Task
                </li>
                <li [ngClass]="activeTab=='futureTaskByMe'?'active':''" (click)="activeTab='futureTaskByMe'; getTaskByType(-7)">
                    Future Task
                </li>
                <li [ngClass]="activeTab=='todoList'?'active':''" (click)="activeTab='todoList'; getTodoTaskList()">
                    ToDo List
                </li>
                <li [ngClass]="activeTab=='scheduleMaster'?'active':''" (click)="activeTab='scheduleMaster'; getScheduledTask()">
                    Scheduled Task Master
                </li>
                <li [ngClass]="activeTab=='unreadTaskByMe'?'active':''" (click)="activeTab='unreadTaskByMe'; getTaskByType(-8)">
                    Unread Task
                </li>
                <li [ngClass]="activeTab=='unreadLeads'?'active':''" (click)="activeTab='unreadLeads'; getProcessLeadByType(5)">
                    Unread Txn
                </li>
                <!-- <li [ngClass]="activeTab=='ScheduledTask'?'active':''" (click)="activeTab='ScheduledTask'; getTaskByType(103)">
                    Scheduled Task
                </li>
                <li [ngClass]="activeTab=='holdTask'?'active':''" (click)="activeTab='holdTask'; getTaskByType(-9)">
                    Hold Task
                </li> -->
            </ul>
        </div>

        <div *ngIf="activeTab=='TasksForMe'">
            <ul class="tabs_style text-left">
                <li [ngClass]="!activeSabTab?'active':''" (click)="activeSabTab=0; filterTaskBySubTab(101,0)">
                    All
                </li>
                <li [ngClass]="activeSabTab==1?'active':''" (click)="activeSabTab=1; filterTaskBySubTab(101,1)">
                    Normal
                </li>
                <li [ngClass]="activeSabTab==2?'active':''" (click)="activeSabTab=2; filterTaskBySubTab(101,2)">
                    Scheduled
                </li>
                <li [ngClass]="activeSabTab==3?'active':''" (click)="activeSabTab=3; filterTaskBySubTab(101,3)">
                    Hold
                </li>
            </ul>
            <smart-table *ngIf="normalTaskList.length!=0" [data]="tableNormal.data" [settings]="tableNormal.settings" id="normalTaskList" class="sl-smart-table">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='TasksByMe'">
            <ul class="tabs_style text-left">
                <li [ngClass]="!activeSabTab?'active':''" (click)="activeSabTab=0; filterTaskBySubTab(-101,0)">
                    All
                </li>
                <li [ngClass]="activeSabTab==1?'active':''" (click)="activeSabTab=1; filterTaskBySubTab(-101,1)">
                    Normal
                </li>
                <li [ngClass]="activeSabTab==2?'active':''" (click)="activeSabTab=2; filterTaskBySubTab(-101,2)">
                    Scheduled
                </li>
                <li [ngClass]="activeSabTab==3?'active':''" (click)="activeSabTab=3; filterTaskBySubTab(-101,3)">
                    Hold
                </li>
            </ul>
            <smart-table *ngIf="normalTaskByMeList.length!=0" [data]="tableNormalTaskByMe.data" [settings]="tableNormalTaskByMe.settings" id="normalTaskByMeListx" class="sl-smart-table">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='scheduleMaster'">
            <smart-table *ngIf="scheduleMasterList.length!=0" [data]="tableScheduleMaster.data" [settings]="tableScheduleMaster.settings" id="scheduleMasterList">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='ScheduledTask'">
            <smart-table *ngIf="scheduledTaskList.length!=0" [data]="tableSchedule.data" [settings]="tableSchedule.settings" id="scheduledTaskList">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='allCompletedTask'">
            <div class="row" style="z-index: 999;">
                <div class="col-4">
                    <uj-date-time-picker [isStart]="true" [isTime]="false" [dateTimeValue]="searchTask.startDate" (onChanged)="searchTask.startDate=$event">
                    </uj-date-time-picker>
                </div>
                <div class="col-4">
                    <uj-date-time-picker [isStart]="true" [isTime]="false" [dateTimeValue]="searchTask.endDate" (onChanged)="searchTask.endDate=$event">
                    </uj-date-time-picker>
                </div>
                <div class="col-4">
                    <button class="btn btn-primary text-capitalize" (click)="searchAllCompletedTask()">Search</button>
                </div>
            </div>
            <smart-table *ngIf="allCompletedTaskList.length!=0" [data]="tableAllCompleted.data" [settings]="tableAllCompleted.settings" id="tableallCompletedTaskList" class="sl-smart-table">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='ccTask'">
            <smart-table *ngIf="ccTaskList.length!=0" [data]="tableCCTask.data" [settings]="tableCCTask.settings" id="tableCCTaskList">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='projectTask'">
            <smart-table *ngIf="projectTaskList.length!=0" [data]="tableProjectTask.data" [settings]="tableProjectTask.settings" id="tableProjectTaskList">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='todoList'">
            <div class="row mb-1">
                <div class="col-5">
                    <textarea row="3" cols="15" placeholder="Enter Description" name="todoDesc" class="form-control" [(ngModel)]="taskTodoForm.desc" resize="true" style="height: 40px!important;"></textarea>
                </div>
                <div class="col-3" style="z-index: 999;">
                    <uj-date-time-picker [mind]="minDateTodo" [isStart]="true" [isTime]="false" (onChanged)="taskTodoForm.date=$event" [dateTimeValue]="taskTodoForm.date">
                    </uj-date-time-picker>
                </div>
                <div class="col-2">
                    <label>
                    <input type="checkbox" [checked]="taskTodoForm.isUrgent" (change)="taskTodoForm.isUrgent = !taskTodoForm.isUrgent" />
                    High-Priority</label>
                </div>
                <div class="col-2">
                    <button class="btn btn-primary btn-sm" (click)="saveTaskTodo()" title="Save ToDo">save</button>
                </div>
            </div>
            <smart-table [data]="tableTaskTodoList.data" [settings]="tableTaskTodoList.settings" id="tableTaskTodoList" class="sl-smart-table">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='futureTaskByMe'">
            <smart-table *ngIf="futureTaskByMeList.length!=0" [data]="tableFutureTaskByMeList.data" [settings]="tableFutureTaskByMeList.settings" id="tableFutureTaskForMeList">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='holdTask'">
            <smart-table [data]="tableHoldTask.data" [settings]="tableHoldTask.settings" id="tableHoldTaskList">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='unreadTaskByMe'">
            <smart-table *ngIf="unreadTaskForMeList.length!=0" [data]="tableUnreadTaskForMeList.data" [settings]="tableUnreadTaskForMeList.settings" id="tableUnreadTaskForMeList">
            </smart-table>
        </div>
        <div *ngIf="activeTab=='unreadLeads'">
            <smart-table *ngIf="unreadLeads.length!=0" [data]="tableUnreadLeads.data" [settings]="tableUnreadLeads.settings" id="tableUnreadLeads">
            </smart-table>
        </div>
        
    </nb-card-body>


    <!-- start: scheduled task  modal -->
    <div class="modal" id="schedukedTaskMasterModal" #schedukedTaskMasterModal>
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h5 class="modal-title">Scheduled Task Master</h5>
                    <button type="button" class="close" data-dismiss="modal" (click)="closeSchedukedTaskMasterModal(null)">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="container">
                        <div class="row mb-2">
                            <div class="col-5">
                                <label>Department<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-7">
                                <auto-suggestion (onSelected)="scheduledTask.department = $event" [data]="departmentList" display="name" seperator="-" placeholder="Select Department" autocomplete="off" name="departmentId" inputId="departmentId" [preSelected]="scheduledTask.department.id ? {name: scheduledTask.department.name}:{name:''}">
                                </auto-suggestion>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5">
                                <label>Description<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-7">
                                <textarea row="2" cols="15" placeholder="Enter Description" name="description" class="form-control" [(ngModel)]="scheduledTask.description"></textarea>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5">
                                <label>Primary User<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-7">
                                <auto-suggestion (onSelected)="scheduledTask.primaryUser = $event" [data]="adminList" display="name" seperator="-" placeholder="Primary User" autocomplete="off" name="primaryUser" inputId="primaryUserId" [preSelected]="scheduledTask.primaryUser.id ? {name: scheduledTask.primaryUser.name}:{name:''}">
                                </auto-suggestion>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5">
                                <label>Escalation User<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-7">
                                <auto-suggestion (onSelected)="scheduledTask.escalationUser = $event" [data]="adminList" display="name" seperator="-" placeholder="Escalation User" autocomplete="off" name="escalationUser" inputId="scalationUserId" [preSelected]="scheduledTask.escalationUser.id ? {name: scheduledTask.escalationUser.name}:{name:''}">
                                </auto-suggestion>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5">
                                <label>Reporting User<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-7">
                                <auto-suggestion (onSelected)="scheduledTask.reportingUser = $event" [data]="adminList" display="name" seperator="-" placeholder="Reporting User" autocomplete="off" name="reportingUser" inputId="reportingUserId" [preSelected]="scheduledTask.reportingUser.id ? {name: scheduledTask.reportingUser.name}:{name:''}">
                                </auto-suggestion>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5">
                                <label>Days<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-7">
                                <input style="width: 100%;" type="number" maxlength="2" placeholder="Days" class="form-control" [(ngModel)]="scheduledTask.days">
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5">
                                <label>Hours<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-7">
                                <input style="width: 100%;" type="number" placeholder="Hours" class="form-control" [(ngModel)]="scheduledTask.hours">
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5">
                                <label>CC users:</label>
                            </div>
                            <div class="col-7">
                                <auto-suggestion [data]="adminList" display="name" seperator="-" placeholder="Select CC Users" [preSelected]="scheduledTask.ccUsers" (onSelected)="scheduledTask.ccUsers = $event" inputId="ccUsers" name="ccUsers" isMultiSelect="true" autocomplete="off"></auto-suggestion>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5">
                                <label class="mr-1">Is Active</label>
                            </div>
                            <div class="col-7">
                                <input type="checkbox" [checked]="scheduledTask.isActive" (change)="scheduledTask.isActive = !scheduledTask.isActive" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 text-right">
                                <button class="btn btn-primary btn-sm mr-2" id="button" (click)="closeSchedukedTaskMasterModal(null)">Close</button>
                                <button class="btn btn-primary btn-sm" id="button" (click)="saveScheduleTask()">Save</button>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
    <!-- end: scheduled task modal -->
    <!-- start: search task  modal -->
    <div class="modal" id="searchTaskModal" #searchTaskModal>
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h5 class="modal-title" >Searched Task</h5>
                    <button type="button" class="close" data-dismiss="modal" (click)="closeSearchTaskModal()">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <smart-table [data]="tableSearchTaskList.data" [settings]="tableSearchTaskList.settings" id="tableSearchTaskList">
                    </smart-table>
                </div>
            </div>
        </div>
    </div>
    <!-- end: search task modal -->
</nb-card>