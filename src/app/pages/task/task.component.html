<nb-card>
  <nb-card-header>
    <div class="row">
      <div class="col-10">

        <h5>Tasks</h5>

      </div>
      <div class="col text-right">
        <select class="form-control" name="task_type" [(ngModel)]="task_type">
          <option value="1">Normal Task</option>
          <option value="2">Scheduled Task</option>

        </select>
      </div>

    </div>


  </nb-card-header>
  <nb-card>
    <nb-card-body>

      <!-- Normal Task Form      -->

      <div *ngIf="task_type == 1">
        <div class="container">
          <div class="row ">
            <div class="col-3">
              <div class="form-group">
                <label>User</label>
              <auto-suggestion (onSelected)="selectedNormalUser($event)" url="Admin/searchAdmin.json" [display]="['name']"
                seperator="-" placeholder="Search User" autocomplete="off" inputId="id" [preSelected]='{name: normalTask.userName}'>
              </auto-suggestion>
              </div>
            </div>
            <div class="col-3">                
                  <div class="form-group">
                    <label>Last Date</label>
                    <uj-date-time-picker [mind]="normalTask.date" [isStart]="true"  [isTime]="false" (onChanged)="normalTask.date=$event" [dateTimeValue]="normalTask.date" > </uj-date-time-picker>
                  </div>
            </div>
            <div class="col-3">
                <div class="form-group">
                  <label>Task</label>
                  <textarea row="2" cols="15" placeholder="Enter Task" name="nomaltask" class="form-control" [(ngModel)]="normalTask.task"
                    class="form-control"></textarea>
                </div>
            </div>
            <div class="col-3">
              <div class="form-group" style="display: flex;
              align-items: center;
              justify-content: center;">
                <input type="checkbox" [checked]="normalTask.isUrgent" (change)="normalTask.isUrgent = !normalTask.isUrgent"/>
              <label style="margin-left: 5px;;"><strong>Urgent</strong></label>
              </div>
            </div>
          </div>
          <div class="row mt-1">
            <div class="col-12 text-right">
              <button class="btn btn-primary text-capitalize" id="button" (click)="saveUser('normalTask')">Save</button>
            </div>
          </div>
        </div>

      </div>

      <!-- Schedule task Form -->

      <div *ngIf="task_type == 2">

      <div class="container">
        <div class="row ">
          <div class="col-4">
            <div class="form-group">
              <label>Description</label>
              <input style="width: 100%;" type="description" placeholder="Description" class="form-control" [(ngModel)]="scheduledTask.description">
            </div>
          </div>
          <div class="col-4">                
                <div class="form-group">
                  <label>Primary User</label>
            <auto-suggestion (onSelected)="selectedPrimarUser($event)" url="Admin/searchAdmin.json" [display]="['name']"
              seperator="-" placeholder="Primary User" autocomplete="off" inputId="id" [preSelected]='{name: scheduledTask.primaryUser}'>
            </auto-suggestion>
                </div>
          </div>
          <div class="col-4">
              <div class="form-group">
                <label>Escalation User</label>
                <auto-suggestion (onSelected)="selectedEscalationUser($event)" url="Admin/searchAdmin.json" [display]="['name']"
                  seperator="-" placeholder="Escalation User" autocomplete="off" inputId="id" [preSelected]='{name: scheduledTask.escalationUser}'> 
                </auto-suggestion>
              </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <label>Reporting User</label>
              <auto-suggestion (onSelected)="selectedReportingUser($event)" url="Admin/searchAdmin.json"
                [display]="['name']" seperator="-" placeholder="Reporting User" autocomplete="off" inputId="id" [preSelected]='{name: scheduledTask.reportingUser}'>
              </auto-suggestion>
            </div>
        </div>
        <div class="col-4">
          <div class="form-group">
            <label>Logic Type</label>
            <input type="number"  maxlength="1" style="width: 100%;" placeholder="Logic Type" class="form-control" [(ngModel)]="scheduledTask.logicType">
          </div>
      </div>
      <div class="col-4">
        <div class="form-group">
          <label>Schedule Param</label>
          <input style="width: 100%;" type="number" maxlength="1" placeholder="Schedule Params" class="form-control" [(ngModel)]="scheduledTask.scheduleParam">
        </div>
      </div>
      <div class="col-4">
        <div class="form-group">
          <label>Days</label>
          <input style="width: 100%;" type="number" maxlength="2" placeholder="Days" class="form-control" [(ngModel)]="scheduledTask.days">
        </div>
      </div>
      <div class="col-4">
        <div class="form-group">
          <label>Hours</label>
          <input style="width: 100%;" type="number"  placeholder="Hours" class="form-control" [(ngModel)]="scheduledTask.hours">
        </div>
      </div>
        </div>



        <div class="row mt-1">
          <div class="col-12 text-right">
            <button class="btn btn-primary text-capitalize" id="button" (click)="saveUser('scheduledTask')">Save</button>
          </div>
        </div>
      </div>

    </div>




      <!-- Tabs      -->

      <div class="tabs_style_main">
        <ul class="tabs_style text-left">
          <li [ngClass]="activeTab=='Normal Task'?'active':''" (click)="activeTab='Normal Task'; getNormalTask()">Normal
            Tasks
          </li>

          <li [ngClass]="activeTab=='Scheduled Master Task'?'active':''" (click)="activeTab='Scheduled Master Task'; getMasterScheduledTask()">
            Scheduled Task
          </li>

          <li [ngClass]="activeTab=='Scheduled Task'?'active':''" (click)="activeTab='Scheduled Task'; getScheduledTask()">
            Scheduled Task Master
          </li>

        </ul>

      </div>
      

        <div *ngIf="activeTab=='Normal Task'">

        <smart-table *ngIf="normalTaskList.length!=0" [data]="tableNormal.data" [settings]="tableNormal.settings"
        id="normalTaskList">
        </smart-table>

        </div>

        <div *ngIf="activeTab=='Scheduled Master Task'">

        <smart-table *ngIf="scheduleMasterTaskList.length!=0" [data]="tableMasterSchedule.data" [settings]="tableMasterSchedule.settings"
        id="scheduleMasterTaskList">
        </smart-table>
  
        </div>

        <div *ngIf="activeTab=='Scheduled Task'">

          <smart-table *ngIf="scheduledTaskList.length!=0" [data]="tableSchedule.data" [settings]="tableSchedule.settings"
          id="scheduledTaskList">
          </smart-table>
    
        </div>


    </nb-card-body>

  </nb-card>

  <script> 
    $(function() { 
        $("input[name='numonly']").on('input', function(e) { 
            $(this).val($(this).val().replace(/[^0-9]/g, '')); 
        }); 
    }); 
</script>